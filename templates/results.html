<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Financial Plan | Results</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--primary);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--gray);
            max-width: 600px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            margin-bottom: 30px;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
        }

        .results-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }

        .results-header i {
            font-size: 2.5rem;
            color: var(--primary);
        }

        .results-header h2 {
            font-size: 1.8rem;
            color: var(--dark);
        }

        .key-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            transition: var(--transition);
            border-left: 4px solid var(--primary);
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .metric-card.highlight {
            background: linear-gradient(135deg, #4361ee, #7209b7);
            color: white;
        }

        .metric-card.highlight .metric-value {
            color: white;
        }

        .metric-card.highlight .metric-label {
            color: rgba(255, 255, 255, 0.9);
        }

        .metric-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .metric-card.highlight .metric-icon {
            color: white;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .metric-label {
            font-size: 1rem;
            color: var(--gray);
        }

        .chart-container {
            margin: 30px 0;
            padding: 25px;
            background: var(--light);
            border-radius: var(--border-radius);
            text-align: center;
        }
        
        /* Responsive Image Fix */
        .chart-placeholder img {
            max-width: 100%; /* Image will never be wider than its container */
            height: auto; /* Maintain aspect ratio */
            border-radius: 8px; /* Nice visual touch */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        /* Remove fixed height on placeholder to allow the image to dictate height */
        .chart-placeholder {
            /* height: 300px; */ /* Removed this fixed height */
            background: white;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: var(--gray);
            border: 2px dashed var(--light-gray);
            padding: 10px; /* Add some padding */
        }

        .chart-placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .investment-mix {
            margin: 30px 0;
        }

        .mix-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mix-header i {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .mix-bars {
            display: flex;
            height: 40px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .mix-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            transition: var(--transition);
        }

        .mix-bar:hover {
            transform: scale(1.05);
        }

        .mix-bar.stocks {
            background: linear-gradient(to right, #4361ee, #3a56d4);
        }

        .mix-bar.bonds {
            background: linear-gradient(to right, #4cc9f0, #3ab4d4);
        }

        .mix-bar.cash {
            background: linear-gradient(to right, #7209b7, #5c07a0);
        }

        .mix-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .success-probability {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--light);
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 30px 0;
        }

        .probability-text {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .probability-text i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .probability-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }

        .btn {
            padding: 15px 30px;
            border-radius: var(--border-radius);
            font-weight: 600;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            cursor: pointer;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(to right, var(--primary-dark), var(--secondary));
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-outline {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(67, 97, 238, 0.2);
        }

        .disclaimer {
            background-color: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 30px;
        }

        .disclaimer strong {
            color: #e6a700;
        }

        @media (max-width: 768px) {
            .card {
                padding: 25px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .key-metrics {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-chart-line"></i>
            </div>
            <h1>Your Financial Plan</h1>
            <p class="subtitle">Here's your personalized financial roadmap to achieve your goals</p>
        </header>

        <div class="card">
            <div class="results-header">
                <i class="fas fa-chart-pie"></i>
                <h2>Financial Plan Results</h2>
            </div>

            <div class="key-metrics">
                <div class="metric-card highlight">
                    <div class="metric-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <!-- Using jinja filter for formatting -->
                    <div class="metric-value">â‚¹{{ monthly_contrib|round(2) }}</div>
                    <div class="metric-label">Monthly Contribution</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="metric-value">{{ sim_results.success_prob|round(2) }}%</div>
                    <div class="metric-label">Success Probability</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <!-- Accessing 'years' from the context passed by home() if available, otherwise defaulting -->
                    <div class="metric-value">{{ years|default('N/A') }}</div>
                    <div class="metric-label">Time Horizon</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>Wealth Projection Over Time</h3>
                <div class="chart-placeholder">
                
                <!-- This line is correct for displaying the dynamically generated chart -->
                <img src="{{ url_for('static', filename='wealth_chart.png') }}" alt="Wealth Projection" onerror="this.onerror=null;this.src='https://placehold.co/600x400/CCCCCC/333333?text=Chart+Unavailable';">
                 </div>
            </div>
            

            <div class="investment-mix">
                <div class="mix-header">
                    <i class="fas fa-chart-pie"></i>
                    <h3>Recommended Investment Mix</h3>
                </div>
                <div class="mix-bars">
                    <!-- Dynamic mix bars using calculated values -->
                    <div class="mix-bar stocks" style="width: {{ (investment_mix.stocks * 100)|round(0) }}%;">{{ (investment_mix.stocks * 100)|round(1) }}% Stocks</div>
                    <div class="mix-bar bonds" style="width: {{ (investment_mix.bonds * 100)|round(0) }}%;">{{ (investment_mix.bonds * 100)|round(1) }}% Bonds</div>
                    <!-- Note: If stocks+bonds doesn't equal 100 due to rounding, the bars might not fill/fit perfectly -->
                </div>
                <div class="mix-labels">
                    <span>Higher Growth ({{ (investment_mix.stocks * 100)|round(1) }}%)</span>
                    <span>Lower Risk ({{ (investment_mix.bonds * 100)|round(1) }}%)</span>
                </div>
                <p style="margin-top: 15px; color: var(--gray); font-size: 0.9rem;">
                    Based on your <strong>{{ risk_tolerance|default('N/A') }}</strong> risk tolerance.
                </p>
            </div>

            <div class="success-probability">
                <div class="probability-text">
                    <i class="fas fa-trophy"></i>
                    <div>
                        <div class="metric-label">Probability of Achieving Your Goal</div>
                        <div class="probability-value">{{ sim_results.success_prob|round(1) }}%</div>
                    </div>
                </div>
                <div class="probability-meter">
                    <!-- Visual meter using the success probability -->
                    <div style="width: 200px; height: 10px; background: var(--light-gray); border-radius: 5px; overflow: hidden;">
                        <div style="width: {{ sim_results.success_prob }}%; height: 100%; background: linear-gradient(to right, #4cc9f0, #4361ee);"></div>
                    </div>
                </div>
            </div>

            <div class="actions">
                <a href="/" class="btn btn-primary">
                    <i class="fas fa-redo"></i>
                    Plan Another Goal
                </a>
                <a href="/goal/{{ goal_id }}" class="btn btn-outline" target="_blank">
                    <i class="fas fa-search"></i>
                    View Raw Data
                </a>
            </div>
        </div>

        <div class="disclaimer">
            <p><strong>Disclaimer:</strong> This financial planning tool is for educational purposes only. Results are estimates based on the information provided and are not financial advice. Past performance is not indicative of future results. Please consult with a qualified financial advisor before making investment decisions.</p>
        </div>
    </div>

    <script>
        // Add some interactive elements
        document.addEventListener('DOMContentLoaded', function() {
            // Animate metric cards on load
            const metricCards = document.querySelectorAll('.metric-card');
            metricCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 200);
            });
            
            // Add hover effect to investment mix bars
            const mixBars = document.querySelectorAll('.mix-bar');
            mixBars.forEach(bar => {
                bar.addEventListener('mouseover', function() {
                    this.style.filter = 'brightness(1.2)';
                });
                
                bar.addEventListener('mouseout', function() {
                    this.style.filter = 'brightness(1)';
                });
            });
        });
    </script>
</body>
</html>
